# ROSç¯€é»test

---

# æ¸¬è©¦ä¸€ã€åŒä¸€å€‹å®¹å™¨çš„å…©å€‹ç¯€é»

## ğŸ¯ **ç›®æ¨™**

- **å…©å€‹ç¯€é» (Node)**
    - ä¸€å€‹ Publisher
    - ä¸€å€‹ Subscriber
- å®ƒå€‘é€é Docker å…§ ROS 2 é€šè¨Š
- ä½¿ç”¨æœ€åŸºæœ¬çš„ **std_msgs/String**
    
    ---
    
    ## ğŸ“¦ **ç¯„ä¾‹çµæ§‹**
    
    ```
    ros2_ws/
    â””â”€â”€ src/
        â””â”€â”€ simple_comm/
            â”œâ”€â”€ package.xml
            â”œâ”€â”€ setup.py
            â””â”€â”€ simple_comm/
                â”œâ”€â”€ __init__.py
                â”œâ”€â”€ talker.py  â† Publisher
                â””â”€â”€ listener.py â† Subscriber
    
    ```
    
    ---
    
    ## ğŸš€ **æ­¥é©Ÿ**
    
    ### 1ï¸âƒ£ **å»ºç«‹å¥—ä»¶**
    
    åœ¨ Docker container è£¡åŸ·è¡Œï¼š
    
    ```bash
    cd /ros2_ws/src
    ros2 pkg create --build-type ament_python simple_comm --dependencies rclpy std_msgs
    
    ```
    
    ---
    
    ### 2ï¸âƒ£ **ç·¨è¼¯ `talker.py` (Publisher)**
    
    ```python
    # simple_comm/simple_comm/talker.py
    import rclpy
    from rclpy.node import Node
    from std_msgs.msg import String
    
    class Talker(Node):
        def __init__(self):
            super().__init__('talker')
            self.publisher_ = self.create_publisher(String, 'chatter', 10)
            self.timer = self.create_timer(1.0, self.timer_callback)
    
        def timer_callback(self):
            msg = String()
            msg.data = 'Hello from Talker!'
            self.publisher_.publish(msg)
            self.get_logger().info(f'Publishing: "{msg.data}"')
    
    def main(args=None):
        rclpy.init(args=args)
        node = Talker()
        rclpy.spin(node)
        node.destroy_node()
        rclpy.shutdown()
    
    if __name__ == '__main__':
        main()
    
    ```
    
    ---
    
    é€™æ˜¯ ROS 2 **Python ç¯€é»çš„æ¨™æº–å•Ÿå‹•æµç¨‹**ï¼Œæˆ‘å€‘ä¾†ä¸€è¡Œä¸€è¡Œæ‹†è§£çµ¦ä½ çœ‹ï¼Œç°¡å–®æ˜“æ‡‚ ğŸ‘‡
    
    ---
    
    ## ğŸ“Œ **ç¨‹å¼ç¢¼èªªæ˜**
    
    ```python
    rclpy.init(args=args)
    
    ```
    
    ğŸ”¸ **åˆå§‹åŒ– rclpyï¼ˆROS 2 Python client libraryï¼‰**
    
    - ROS 2 éœ€è¦å…ˆåˆå§‹åŒ–ï¼Œæ‰èƒ½å»ºç«‹ Nodeã€‚
    - `args=args` å…è¨±ä½ å¾å‘½ä»¤åˆ—å¸¶åƒæ•¸é€²ä¾†ï¼ˆä¸€èˆ¬æƒ…æ³ä¸‹å¯ä»¥ç›´æ¥å¯« `rclpy.init()` æ²’å•é¡Œï¼‰ã€‚
    
    ---
    
    ```python
    node = Listener()
    
    ```
    
    ğŸ”¸ **å»ºç«‹ä¸€å€‹ Node ç‰©ä»¶**
    
    - é€™è£¡ `Listener()` æ˜¯ä½ è‡ªå®šç¾©çš„ classï¼Œç¹¼æ‰¿è‡ª `rclpy.node.Node`ã€‚
    - åœ¨é€™è£¡æœƒè¨­å®šé€™å€‹ Node çš„åå­—ã€è¨‚é–±çš„ topic ç­‰ã€‚
    
    ---
    
    ```python
    rclpy.spin(node)
    
    ```
    
    ğŸ”¸ **è®“é€™å€‹ Node ä¸æ–·é‹ä½œï¼ˆé€²å…¥äº‹ä»¶å¾ªç’°ï¼‰**
    
    - **æ ¸å¿ƒä½œç”¨**ï¼šè®“ ROS 2 å¹«ä½ è™•ç† callbackï¼ˆä¾‹å¦‚æ”¶åˆ° message æ™‚è§¸ç™¼ listener_callbackï¼‰ã€‚
    - æœƒä¸€ç›´ç­‰å¾… & è™•ç†äº‹ä»¶ï¼Œç›´åˆ°ä½  Ctrl+C çµæŸã€‚
    
    ---
    
    ```python
    node.destroy_node()
    
    ```
    
    ğŸ”¸ **æ¸…ç† Nodeï¼Œé‡‹æ”¾è³‡æº**
    
    - é€šå¸¸æ˜¯å–„å¾Œï¼Œå°‡é€™å€‹ Node é—œé–‰ï¼Œé¿å…è³‡æºä½”ç”¨ã€‚
    
    ---
    
    ```python
    rclpy.shutdown()
    
    ```
    
    ğŸ”¸ **çµæŸ rclpy**
    
    - è®“æ•´å€‹ ROS 2 Python ç³»çµ±æ­£å¸¸é—œé–‰ï¼Œæ”¶å°¾å‹•ä½œã€‚
    
    ---
    
    ## ğŸŸ¢ **ç¸½çµæµç¨‹**
    
    1. `rclpy.init()` â†’ åˆå§‹åŒ– ROS 2
    2. `node = Listener()` â†’ å»ºç«‹ä¸€å€‹ç¯€é»
    3. `rclpy.spin(node)` â†’ è®“ç¯€é»æŒçºŒé‹ä½œï¼Œè™•ç†æ¶ˆæ¯
    4. `node.destroy_node()` â†’ é—œé–‰ç¯€é»
    5. `rclpy.shutdown()` â†’ é—œé–‰ ROS 2 ç¨‹å¼
    
    ---
    
    ## ğŸš€ **å»¶ä¼¸**
    
    ä½ å¯ä»¥æŠŠå®ƒæƒ³æˆï¼š
    
    | é¡æ¯” | ä½œç”¨ |
    | --- | --- |
    | é–‹å•Ÿ ROS 2 ç³»çµ± | `rclpy.init()` |
    | å‰µå»ºä¸€å°æ©Ÿå™¨ | `Listener()` |
    | è®“æ©Ÿå™¨é–‹å§‹å·¥ä½œ | `rclpy.spin()` |
    | é—œæ‰æ©Ÿå™¨ | `destroy_node()` |
    | é—œæ‰é›»æº | `rclpy.shutdown()` |
    
    ### 3ï¸âƒ£ **ç·¨è¼¯ `listener.py` (Subscriber)**
    
    ```python
    # simple_comm/simple_comm/listener.py
    import rclpy
    from rclpy.node import Node
    from std_msgs.msg import String
    
    class Listener(Node):
        def __init__(self):
            super().__init__('listener')
            self.subscription = self.create_subscription(
                String,
                'chatter',
                self.listener_callback,
                10
            )
    
        def listener_callback(self, msg):
            self.get_logger().info(f'I heard: "{msg.data}"')
    
    def main(args=None):
        rclpy.init(args=args)
        node = Listener()
        rclpy.spin(node)
        node.destroy_node()
        rclpy.shutdown()
    
    if __name__ == '__main__':
        main()
    
    ```
    
    ---
    
    ### 4ï¸âƒ£ **ç·¨è¼¯ `setup.py`**
    
    ç¢ºä¿ `entry_points` è£¡é¢æœ‰ï¼š
    
    ```python
    entry_points={
        'console_scripts': [
            'talker = simple_comm.talker:main',
            'listener = simple_comm.listener:main',
        ],
    },
    
    ```
    
    ---
    
    ### 5ï¸âƒ£ **Build & Source**
    
    ```bash
    cd /ros2_ws
    colcon build
    source install/setup.bash
    
    ```
    
    ---
    
    ### 6ï¸âƒ£ **åŸ·è¡Œ Publisher & Subscriber**
    
    é–‹å…©å€‹ terminalï¼Œéƒ½é€²å…¥ Docker containerã€‚
    
    é™¤äº† source `/ros2_ws/install/setup.bash` ä»¥å¤–ï¼Œ**é‚„è¦å…ˆ source ç³»çµ± ROS ç’°å¢ƒ**ã€‚
    
    ä½ ç”¨çš„æ˜¯ **ROS 2 Foxy**ï¼Œæ‰€ä»¥ä»¥ä¸‹å…©å€‹æŒ‡ä»¤éƒ½è¦å…ˆåŸ·è¡Œï¼š
    
    ```bash
    
    source /opt/ros/foxy/setup.bash
    
    ```
    
    ç¬¬ä¸€å€‹ terminalï¼š
    
    ```bash
    source /ros2_ws/install/setup.bash
    ros2 run simple_comm talker
    
    ```
    
    ç¬¬äºŒå€‹ terminalï¼š
    
    ```bash
    source /ros2_ws/install/setup.bash
    ros2 run simple_comm listener
    
    ```
    
    ä½ æœƒçœ‹åˆ°ï¼š
    
    ```
    [INFO] Publishing: "Hello from Talker!"
    [INFO] I heard: "Hello from Talker!"
    
    ```
    
    ---
    
    ### 3ï¸âƒ£ **åŸå› ç‚ºä»€éº¼è¦ source å…©æ¬¡ï¼Ÿ**
    
    | æŒ‡ä»¤ | ä½œç”¨ |
    | --- | --- |
    | `source /opt/ros/foxy/setup.bash` | è¨­å®š ROS 2 åŸºæœ¬ç’°å¢ƒ (`ros2` æŒ‡ä»¤æ‰æœƒæœ‰) |
    | `source /ros2_ws/install/setup.bash` | è¨­å®šä½ è‡ªå·± Build å‡ºä¾†çš„å¥—ä»¶è·¯å¾‘ (åŒ…å« simple_comm) |
    
    ## ğŸŸ¢ **å®Œæˆï¼**
    
    é€™å°±æ˜¯ **æœ€ç°¡å–®çš„ ROS 2 é»å°é»é€šè¨Š**ï¼Œä¸éœ€è¦é¡å¤–ç¡¬é«”ï¼Œå…©å€‹ Node å¯ä»¥åœ¨åŒä¸€ containerï¼Œæˆ–ä¸åŒ container/networkã€‚
    
    ---
    

# æ¸¬è©¦äºŒã€ä¸åŒå®¹å™¨çš„å…©å€‹ç¯€é»

å¤ªå¥½äº†ï¼ä½ æƒ³è¦å¯¦ä½œ **ä¸åŒ Docker container é–“çš„ ROS 2 é€šè¨Š**ï¼Œé€™æ˜¯å¯¦éš›éƒ¨ç½²æ™‚å¾ˆå¸¸è¦‹çš„éœ€æ±‚ï¼Œæ¯”å¦‚å¤šå°è¨­å‚™ã€æ¨¡æ“¬å™¨ã€æ„Ÿæ¸¬å™¨ç¯€é»åˆ†é–‹è·‘ã€‚

æˆ‘ä¾†å¹«ä½ æ•´ç†å®Œæ•´è¨­å®šæ­¥é©Ÿï¼ğŸš€

---

# ğŸ¯ **ç›®æ¨™**

å…©å€‹ **ä¸åŒ Docker container**ï¼š

- ä¸€å€‹è·‘ **Publisher (Talker)**
- ä¸€å€‹è·‘ **Subscriber (Listener)**

è®“å®ƒå€‘é€é **ROS 2 é€šè¨Š**ï¼ŒæˆåŠŸ exchange messageï¼

---

# ğŸŸ¢ **é—œéµåŸç†**

1. **å®¹å™¨é–“ç¶²è·¯è¦äº’é€š**
    
    â†’ ç”¨ Docker è‡ªè¨‚çš„ **bridge network** æˆ– **host network**ã€‚
    
2. **ROS 2 é€šè¨Šä¾è³´ DDS (FastRTPS, CycloneDDS)**ï¼Œéœ€è¦è¨­å®šï¼š
    - `ROS_DOMAIN_ID`ï¼ˆç¢ºä¿ä¸€è‡´ï¼‰
    - `RMW_IMPLEMENTATION`ï¼ˆä¸€è‡´æ€§ï¼‰
    - **å¿…è¦ç’°å¢ƒè®Šæ•¸**ï¼š
        
        ```bash
        ROS_DOMAIN_ID=0
        RMW_IMPLEMENTATION=rmw_fastrtps_cpp
        
        ```
        
3. **å¿…è¦çš„ç’°å¢ƒè®Šæ•¸ (é‡é»)**ï¼š
    - `FASTRTPS_DEFAULT_PROFILES_FILE`ï¼ˆå¦‚éœ€è‡ªè¨‚ï¼‰
    - è¨˜å¾—è¨­å¥½ **Discovery**ï¼Œå¦å‰‡æ‰¾ä¸åˆ°å½¼æ­¤ã€‚

---

# ğŸ› ï¸ **å®Œæ•´è¨­å®šæ–¹æ³•**

## âœ… **æ­¥é©Ÿ 1ï¼šå»ºç«‹ Docker è‡ªè¨‚ bridge network**

é€™æ¨£å…©å€‹ container å¯ä»¥äº’ç›¸ç”¨ IP æˆ–åç¨±æ‰¾åˆ°å½¼æ­¤ã€‚

```bash
docker network create ros2_net

```

---

## âœ… **æ­¥é©Ÿ 2ï¼šå•Ÿå‹•å…©å€‹ container åŠ å…¥ network**

å‡è¨­ä½ æœ‰ä¸€å€‹ ROS 2 image å« `ros2_image`ã€‚

**å•Ÿå‹• Publisher containerï¼š**

```bash
docker run -it --rm --name talker_container --network ros2_net ros2_image

```

**å•Ÿå‹• Subscriber containerï¼š**

```bash
docker run -it --rm --name listener_container --network ros2_net ros2_image

```

---

## âœ… **æ­¥é©Ÿ 3ï¼šè¨­å®š ROS 2 ç’°å¢ƒè®Šæ•¸**

é€²å…¥ **å…©é‚Š container** å…§ï¼ŒåŸ·è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå»ºè­°å¯ä»¥æ”¾é€² `.bashrc`ï¼‰ï¼š

```bash
export ROS_DOMAIN_ID=0
export RMW_IMPLEMENTATION=rmw_fastrtps_cpp

```

---

## âœ… **æ­¥é©Ÿ 4ï¼šå•Ÿå‹•ç¯€é»**

- åœ¨ `talker_container`ï¼š

```bash
source /opt/ros/foxy/setup.bash
source /ros2_ws/install/setup.bash
ros2 run simple_comm talker

```

- åœ¨ `listener_container`ï¼š

```bash
source /opt/ros/foxy/setup.bash
source /ros2_ws/install/setup.bash
ros2 run simple_comm listener

```

---

# ğŸš© **ç‰¹åˆ¥æ³¨æ„ï¼**

### ğŸ”¥ **é˜²ç«ç‰†å•é¡Œ**

- å¦‚æœä½ åœ¨ä¸åŒæ©Ÿå™¨ï¼Œè¨˜å¾—é–‹æ”¾ **UDP 7400-7600 ç«¯å£**ï¼Œå› ç‚º ROS 2 DDS é€šè¨Šç”¨é€™å€‹ç¯„åœã€‚

---

### ğŸ”¥ **å¤šä¸»æ©Ÿéƒ¨ç½² (Optional)**

å¦‚æœä½ çš„ container åœ¨ä¸åŒå¯¦é«”æ©Ÿå™¨ï¼Œé‚„è¦è¨­ï¼š

```bash
export ROS_LOCALHOST_ONLY=0

```

ä¸¦ä¸”æ˜ç¢ºè¨­å®š **Discovery Server**ï¼ˆæˆ–è¨­å¥½ multicast ç¶²è·¯ï¼‰ã€‚

---

## ğŸ“„ **å°çµ**

| è¨­å®šé …ç›® | ç›®çš„ |
| --- | --- |
| Docker network | è®“ containers èƒ½é€šè¨Š |
| ROS_DOMAIN_ID | ç¢ºä¿ DDS å±¬æ–¼åŒä¸€ domain |
| RMW_IMPLEMENTATION | ä¸€è‡´æ€§ |
| source ROS ç’°å¢ƒ | å•Ÿå‹• ROS 2 |
| é¿å…é˜²ç«ç‰†é˜»æ“‹ | é–‹é€š UDP |

---

## setup.pyä¹Ÿè¦æ”¹å§?

ğŸ’¯æ²’éŒ¯ï¼å¦‚æœä½ æƒ³è®“ `setup.py` é©åˆ **å¤š Docker container é€šè¨Šç’°å¢ƒ**ï¼Œå…¶å¯¦ä¸éœ€è¦ä¿®æ”¹å¤ªå¤šï¼Œä½†å¯ä»¥åšä¸€äº›**æœ€ä½³åŒ–èˆ‡æº–å‚™**ï¼Œè®“å®ƒæ›´ç©©å®šã€æ˜“éƒ¨ç½²ã€‚

---

# ğŸ¯ **æœ€å°å¿…è¦ä¿®æ”¹ï¼Ÿ**

âœ… ä¸ç”¨æ”¹ã€‚

ROS 2 çš„ container é–“é€šè¨Šæœ¬è³ªä¸Šè·Ÿå–®ä¸€ container ä¸€æ¨£ï¼Œ**`setup.py` åªéœ€è¦æ­£ç¢ºè¨»å†Š console_scripts**ï¼Œè·Ÿæ˜¯å¦è·¨ container ç„¡é—œã€‚

---

# ğŸ”§ **æœ€ä½³åŒ–å»ºè­° (å¯é¸)**

### 1ï¸âƒ£ **è£œå……èªªæ˜èˆ‡ license**

è®“ `setup.py` æ›´å®Œæ•´ & ä¹¾æ·¨ã€‚

### ğŸ”¸ ä½ ç¾åœ¨æ˜¯é€™æ¨£ï¼š

```python
description='TODO: Package description',
license='TODO: License declaration',

```

### âœ… å»ºè­°æ”¹æˆï¼š

```python
description='Simple ROS2 point-to-point communication between Docker containers',
license='Apache License 2.0',

```

---

### 2ï¸âƒ£ **ç¢ºèª entry_points å®Œæ•´**

ä½ æ‡‰è©²å·²ç¶“æœ‰é€™æ¨£è¨­å®šï¼š

```python
entry_points={
    'console_scripts': [
        'talker = simple_comm.talker:main',
        'listener = simple_comm.listener:main',
    ],
},

```

âœ… é€™æ¨£å°±å¯ä»¥è®“ä½ åœ¨ä»»ä½• container å…§åŸ·è¡Œï¼š

```bash
ros2 run simple_comm talker
ros2 run simple_comm listener

```

---

### 3ï¸âƒ£ **åŠ å…¥ç‰ˆæœ¬è™Ÿèˆ‡ç¶­è­·äººè³‡è¨Šï¼ˆå¯é¸ï¼‰**

ä¾‹å¦‚ï¼š

```python
version='1.0.0',
maintainer='Your Name',
maintainer_email='you@example.com',

```

---

## ğŸ“„ **å®Œæ•´å»ºè­°ç‰ˆ setup.py**

```python
from setuptools import setup

package_name = 'simple_comm'

setup(
    name=package_name,
    version='1.0.0',
    packages=[package_name],
    data_files=[
        ('share/ament_index/resource_index/packages',
            ['resource/' + package_name]),
        ('share/' + package_name, ['package.xml']),
    ],
    install_requires=['setuptools'],
    zip_safe=True,
    maintainer='Your Name',
    maintainer_email='you@example.com',
    description='Simple ROS2 point-to-point communication between Docker containers',
    license='Apache License 2.0',
    tests_require=['pytest'],
    entry_points={
        'console_scripts': [
            'talker = simple_comm.talker:main',
            'listener = simple_comm.listener:main',
        ],
    },
)

```

---

# ğŸš€ å°çµ

| ä½ è¦ä¸è¦æ”¹ `setup.py`ï¼Ÿ | åŸå›  |
| --- | --- |
| âŒ ä¸å¿… | è·¨ container ä¸å½±éŸ¿ `setup.py` çµæ§‹ |
| âœ… å¯ä»¥æœ€ä½³åŒ– | åŠ æè¿°ã€licenseã€ç‰ˆæœ¬ã€email |

---

**éœ€è¦æˆ‘å¹«ä½ å¯« `docker-compose.yml` æ­é…é€™å¥—ä»¶ä¸€æ¬¡å•Ÿå‹•å¤š containerï¼Ÿè¶…æ–¹ä¾¿ï¼** ğŸ˜